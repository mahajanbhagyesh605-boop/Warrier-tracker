<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bike Racer - Nitro Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: white; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; touch-action: manipulation; }
        #gameCanvas { background: #1a1a1a; display: block; width: 100vw; height: 55vh; border-bottom: 4px solid #333; }
        .btn-control { background: rgba(255,255,255,0.05); border: 2px solid #444; border-radius: 50%; width: 65px; height: 65px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 10px; color: #888; transition: 0.1s; }
        .btn-active { background: #3b82f6 !important; border-color: #fff; color: white; transform: scale(0.9); }
        .nitro-active { background: #facc15 !important; border-color: #fff; color: black; box-shadow: 0 0 20px #facc15; }
        #splash { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .locked { filter: grayscale(1) opacity(0.3); pointer-events: none; }
        .nitro-bar-container { width: 100px; height: 8px; background: #222; border-radius: 4px; overflow: hidden; border: 1px solid #444; }
        #nitroFill { height: 100%; width: 0%; background: linear-gradient(90deg, #3b82f6, #60a5fa); transition: width 0.1s; }
    </style>
</head>
<body>

    <div id="splash">
        <div class="w-24 h-24 mb-4 border-4 border-blue-600 rounded-full flex items-center justify-center animate-pulse">
            <span class="text-5xl font-serif italic font-black text-blue-600">B</span>
        </div>
        <h1 class="text-3xl font-black uppercase tracking-[8px]">Bike Racer</h1>
        <p class="text-blue-500 text-[10px] mt-2 font-bold uppercase tracking-widest">Nitro Powered</p>
    </div>

    <div id="menu" class="hidden fixed inset-0 bg-black/95 p-8 z-40 overflow-y-auto">
        <h2 class="text-xl font-black text-center mb-8 uppercase tracking-widest text-blue-500">Select Track</h2>
        <div id="levelGrid" class="grid grid-cols-2 sm:grid-cols-5 gap-4"></div>
    </div>

    <div id="ui" class="hidden">
        <div class="flex justify-between items-center p-4 bg-black border-b border-white/10">
            <div>
                <p class="text-[9px] text-gray-500 uppercase font-black">Level <span id="currentLevelText">1</span></p>
                <p class="text-lg font-black font-mono" id="timer">00:00</p>
            </div>
            <div class="flex flex-col items-center">
                <p class="text-[9px] text-blue-400 uppercase font-black mb-1">Nitro</p>
                <div class="nitro-bar-container"><div id="nitroFill"></div></div>
            </div>
            <div class="text-right">
                <p class="text-[9px] text-gray-500 uppercase font-black">Rank</p>
                <p class="text-lg font-black text-blue-500" id="posText">1/5</p>
            </div>
        </div>
        
        <canvas id="gameCanvas"></canvas>

        <div class="fixed bottom-0 left-0 right-0 h-[35vh] bg-black p-4 grid grid-cols-2">
            <div class="flex flex-col justify-center gap-4">
                <div class="flex gap-4">
                    <div id="btnLeft" class="btn-control">LEFT</div>
                    <div id="btnRight" class="btn-control">RIGHT</div>
                </div>
            </div>
            <div class="flex flex-col items-end justify-center gap-4">
                <div id="btnNitro" class="btn-control !w-full !rounded-xl border-blue-500 text-blue-400">NITRO BOOST</div>
                <div class="flex gap-4">
                    <div id="btnBrake" class="btn-control border-red-900 text-red-700">BRAKE</div>
                    <div id="btnGo" class="btn-control border-green-900 text-green-700 text-xl">GAS</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let unlocked = parseInt(localStorage.getItem('bikeRacerLevels')) || 1;
        let currentLevel = 1;
        let gameActive = false;
        let trackLength = 0;
        let finishLine = 0;
        let shake = 0;

        const player = { x: 200, y: 0, speed: 0, lane: 2, targetX: 200, nitro: 100 };
        const opponents = [];
        const lanes = [40, 110, 180, 250, 320];

        setTimeout(() => {
            document.getElementById('splash').style.opacity = '0';
            setTimeout(() => { document.getElementById('splash').style.display = 'none'; showMenu(); }, 800);
        }, 1500);

        function showMenu() {
            document.getElementById('menu').classList.remove('hidden');
            const grid = document.getElementById('levelGrid');
            grid.innerHTML = '';
            for(let i=1; i<=10; i++) {
                const btn = document.createElement('button');
                btn.className = `p-6 rounded-2xl font-black text-xl border-2 transition-all ${i <= unlocked ? 'border-blue-600 bg-blue-900/10 text-white' : 'border-gray-900 text-gray-700 locked'}`;
                btn.innerText = i;
                btn.onclick = () => startLevel(i);
                grid.appendChild(btn);
            }
        }

        function startLevel(num) {
            currentLevel = num;
            gameActive = true;
            trackLength = (60 + (num - 1) * 30) * 120; // Feature: Increased time per level
            finishLine = trackLength - 600;
            player.y = 0; player.speed = 0; player.lane = 2; player.nitro = 100;
            
            opponents.length = 0;
            for(let i=0; i<4; i++) {
                opponents.push({
                    x: lanes[i < 2 ? i : i + 1],
                    y: Math.random() * -300,
                    speed: 6 + (num * 0.7) + Math.random() * 2,
                    color: `hsl(${200 + Math.random() * 50}, 80%, 40%)`
                });
            }

            document.getElementById('menu').classList.add('hidden');
            document.getElementById('ui').classList.remove('hidden');
            resize();
            requestAnimationFrame(gameLoop);
        }

        function resize() { canvas.width = window.innerWidth; canvas.height = canvas.offsetHeight; }

        const keys = {};
        const setupBtn = (id, key) => {
            const el = document.getElementById(id);
            const start = (e) => { e.preventDefault(); keys[key] = true; el.classList.add(key === 'nitro' ? 'nitro-active' : 'btn-active'); };
            const end = () => { keys[key] = false; el.classList.remove('btn-active', 'nitro-active'); };
            el.addEventListener('touchstart', start); el.addEventListener('touchend', end);
            el.addEventListener('mousedown', start); el.addEventListener('mouseup', end);
        };
        setupBtn('btnGo', 'go'); setupBtn('btnBrake', 'brake'); setupBtn('btnLeft', 'left'); setupBtn('btnRight', 'right'); setupBtn('btnNitro', 'nitro');

        function gameLoop() {
            if(!gameActive) return;
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            // Speed Logic
            let maxSpeed = 14 + (currentLevel * 0.5);
            let accel = 0.15;

            if(keys.nitro && player.nitro > 0) {
                maxSpeed *= 1.8;
                accel = 0.4;
                player.nitro -= 0.8;
                shake = 5;
            } else {
                player.nitro = Math.min(100, player.nitro + 0.1);
                shake *= 0.9;
            }

            if(keys.go) player.speed += accel;
            else if(keys.brake) player.speed -= 0.4;
            else player.speed -= 0.08;

            player.speed = Math.max(0, Math.min(player.speed, maxSpeed));
            player.y += player.speed;

            // Steering
            if(keys.left && player.lane > 0) { player.lane--; keys.left = false; }
            if(keys.right && player.lane < 4) { player.lane++; keys.right = false; }
            player.x += (lanes[player.lane] - player.x) * 0.2;

            opponents.forEach(o => { o.y += o.speed; if(o.y > player.y + 1200) o.y -= 2400; });

            let pos = 1;
            opponents.forEach(o => { if(o.y > player.y) pos++; });
            document.getElementById('posText').innerText = `${pos}/5`;
            document.getElementById('timer').innerText = `FINISH: ${Math.floor(Math.max(0, (finishLine - player.y)/100))}m`;
            document.getElementById('nitroFill').style.width = player.nitro + '%';

            if(player.y >= finishLine) {
                gameActive = false;
                if(pos === 1) {
                    alert("LEVEL COMPLETE! Bugatti Performance Proven.");
                    if(currentLevel === unlocked && unlocked < 10) unlocked++;
                    localStorage.setItem('bikeRacerLevels', unlocked);
                } else { alert("FAILED! You must be 1st."); }
                document.getElementById('ui').classList.add('hidden');
                showMenu();
            }
        }

        function draw() {
            ctx.save();
            if(shake > 0.1) ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2);
            
            ctx.fillStyle = '#111';
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            // Road Lines
            ctx.strokeStyle = '#333';
            ctx.setLineDash([30, 30]);
            ctx.lineWidth = 2;
            lanes.forEach(l => {
                ctx.beginPath(); ctx.moveTo(l + 35, 0); ctx.lineTo(l + 35, canvas.height); ctx.stroke();
            });

            // Finish Line
            if(finishLine - player.y < 1000) {
                ctx.fillStyle = 'white';
                for(let i=0; i<10; i++) {
                    ctx.fillRect(i*canvas.width/10, canvas.height/2 + (finishLine - player.y), canvas.width/20, 20);
                }
            }

            opponents.forEach(o => {
                const screenY = canvas.height/2 + (o.y - player.y);
                if(screenY > -50 && screenY < canvas.height + 50) drawBike(o.x, screenY, o.color, false);
            });

            drawBike(player.x, canvas.height/2, '#3b82f6', keys.nitro && player.nitro > 0);
            ctx.restore();
        }

        function drawBike(x, y, color, isNitro) {
            if(isNitro) {
                ctx.fillStyle = '#facc15';
                ctx.beginPath(); ctx.moveTo(x+17, y+20); ctx.lineTo(x+10, y+50); ctx.lineTo(x+25, y+50); ctx.fill();
            }
            ctx.fillStyle = 'black';
            ctx.fillRect(x + 12, y - 25, 11, 10); // Front wheel
            ctx.fillRect(x + 12, y + 15, 11, 10); // Back wheel
            ctx.fillStyle = color;
            ctx.fillRect(x + 10, y - 20, 15, 40); // Frame
            ctx.fillStyle = '#555';
            ctx.fillRect(x + 5, y - 5, 25, 5); // Handlebars
        }

        window.addEventListener('resize', resize);
    </script>
</body>
</html>
